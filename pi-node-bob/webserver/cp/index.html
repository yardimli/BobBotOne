<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Bob Admin 2.0</title>

  <!-- Vendor styles -->
  <link rel="stylesheet" href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css">
  <link rel="stylesheet" href="vendors/bower_components/animate.css/animate.min.css">
  <link rel="stylesheet" href="vendors/bower_components/jquery.scrollbar/jquery.scrollbar.css">
  <link rel="stylesheet" href="vendors/bower_components/fullcalendar/dist/fullcalendar.min.css">

  <!-- App styles -->
  <link rel="stylesheet" href="css/app.min.css">
</head>

<body data-sa-theme="1">
<main class="main">
  <div class="page-loader">
    <div class="page-loader__spinner">
      <svg viewBox="25 25 50 50">
        <circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>
      </svg>
    </div>
  </div>

  <header class="header">
    <div class="navigation-trigger hidden-xl-up" data-sa-action="aside-open" data-sa-target=".sidebar">
      <i class="zmdi zmdi-menu"></i>
    </div>

    <div class="logo hidden-sm-down">
      <h1><a href="index.html">Bob Bot Micro</a></h1>
    </div>


    <ul class="top-nav">


      <li class="dropdown hidden-xs-down">
        <a href="" data-toggle="dropdown"><i class="zmdi zmdi-more-vert"></i></a>

        <div class="dropdown-menu dropdown-menu-right">
          <a href="" class="dropdown-item" data-sa-action="fullscreen">Fullscreen</a>
          <a href="" class="dropdown-item">Clear Local Storage</a>
          <a href="" class="dropdown-item">Settings</a>
        </div>
      </li>

      <li class="hidden-xs-down">
        <a href="" class="top-nav__themes" data-sa-action="aside-open" data-sa-target=".themes"><i class="zmdi zmdi-palette"></i></a>
      </li>
    </ul>

    <div class="clock hidden-md-down">
      <div class="time">
        <span class="time__hours"></span>
        <span class="time__min"></span>
        <span class="time__sec"></span>
      </div>
    </div>
  </header>

  <aside class="sidebar">
    <div class="scrollbar-inner">

      <div class="user">
        <div class="user__info" data-toggle="dropdown">
          <img class="user__img" src="demo/img/profile-pics/8.jpg" alt="">
          <div>
            <div class="user__name">Malinda Hollaway</div>
            <div class="user__email">malinda-h@gmail.com</div>
          </div>
        </div>

        <div class="dropdown-menu">
          <a class="dropdown-item" href="">View Profile</a>
          <a class="dropdown-item" href="">Settings</a>
          <a class="dropdown-item" href="">Logout</a>
        </div>
      </div>

      <ul class="navigation">
        <li class="navigation__active"><a href="index.html"><i class="zmdi zmdi-home"></i> Home</a></li>

        <li class="@@widgetactive"><a href="widgets.html"><i class="zmdi zmdi-widgets"></i> Widgets</a></li>
      </ul>
    </div>
  </aside>

  <div class="themes">
    <div class="scrollbar-inner">
      <a href="" class="themes__item active" data-sa-value="1"><img src="img/bg/1.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="2"><img src="img/bg/2.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="3"><img src="img/bg/3.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="4"><img src="img/bg/4.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="5"><img src="img/bg/5.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="6"><img src="img/bg/6.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="7"><img src="img/bg/7.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="8"><img src="img/bg/8.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="9"><img src="img/bg/9.jpg" alt=""></a>
      <a href="" class="themes__item" data-sa-value="10"><img src="img/bg/10.jpg" alt=""></a>
    </div>
  </div>

  <section class="content">
    <header class="content__title">
      <h1>Dashboard</h1>

      <div class="actions">
        <a href="" class="actions__item zmdi zmdi-camera start_camera_btn"></a>
      </div>
    </header>

    <div class="row" id="joystick_control_div">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">

            <img src="/video_stream.jpg?time=1&pDelay=120000" id="stream_container" style="max-width:1024px; width: 100%; padding-top:5px; padding-right:5px;"
                 class="_rotateImage90">

          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <canvas id="image_process_canvas" class="_rotateImage90"></canvas>
          </div>
        </div>
      </div>
    </div>


    <div class="row quick-stats">
      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="front_left_revs">0</h2>
            <small>Front Left Revs</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="front_left_revs_array">6,4,8,6,5,6,7,8,3,5,9</div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="front_right_revs">0</h2>
            <small>Front Right Revs</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="front_right_revs_array">4,7,6,2,5,3,8,6,6,4,8</div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="rear_left_revs">0</h2>
            <small>Rear Left Revs</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="rear_left_revs_array">9,4,6,5,6,4,5,7,9,3,6</div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="rear_right_revs">0</h2>
            <small>Rear Right Revs</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="rear_right_revs_array">5,6,3,9,7,5,4,6,5,6,4</div>
        </div>
      </div>
    </div>

    <div class="row quick-stats">
      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="life_counter">0</h2>
            <small>Life Counter</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="life_counter_array">6,4,8,6,5,6,7,8,3,5,9</div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="distance_sensor">0</h2>
            <small>Distance</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="distance_sensor_array">6,4,8,6,5,6,7,8,3,5,9</div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="floor_sensor_left">0</h2>
            <small>Left Floor Sensor</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="floor_sensor_left_array">6,4,8,6,5,6,7,8,3,5,9</div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="quick-stats__item">
          <div class="quick-stats__info">
            <h2 id="floor_sensor_right">0</h2>
            <small>Right Floor Sensor</small>
          </div>

          <div class="quick-stats__chart peity-bar" id="floor_sensor_right_array">6,4,8,6,5,6,7,8,3,5,9</div>
        </div>
      </div>
    </div>

    <div data-columns>

      <div class="card widget-pie">
        <div class="col-6 col-sm-4 col-md-6 col-lg-4 widget-pie__item">
          <div class="easy-pie-chart" data-percent="50" data-size="80" data-track-color="rgba(0,0,0,0.5)" data-bar-color="#fff">
            <span class="easy-pie-chart__value">92</span>
          </div>
          <div class="widget-pie__title">Email<br> Scheduled</div>
        </div>

        <div class="col-6 col-sm-4 col-md-6 col-lg-4 widget-pie__item">
          <div class="easy-pie-chart" data-percent="11" data-size="80" data-track-color="rgba(0,0,0,0.35)" data-bar-color="#fff">
            <span class="easy-pie-chart__value">11</span>
          </div>
          <div class="widget-pie__title">Email<br> Bounced</div>
        </div>

        <div class="col-6 col-sm-4 col-md-6 col-lg-4 widget-pie__item">
          <div class="easy-pie-chart" data-percent="52" data-size="80" data-track-color="rgba(0,0,0,0.35)" data-bar-color="#fff">
            <span class="easy-pie-chart__value">52</span>
          </div>
          <div class="widget-pie__title">Email<br> Opened</div>
        </div>

        <div class="col-6 col-sm-4 col-md-6 col-lg-4 widget-pie__item">
          <div class="easy-pie-chart" data-percent="44" data-size="80" data-track-color="rgba(0,0,0,0.35)" data-bar-color="#fff">
            <span class="easy-pie-chart__value">44</span>
          </div>
          <div class="widget-pie__title">Storage<br>Remaining</div>
        </div>

        <div class="col-6 col-sm-4 col-md-6 col-lg-4 widget-pie__item">
          <div class="easy-pie-chart" data-percent="78" data-size="80" data-track-color="rgba(0,0,0,0.35)" data-bar-color="#fff">
            <span class="easy-pie-chart__value">78</span>
          </div>
          <div class="widget-pie__title">Web Page<br> Views</div>
        </div>

        <div class="col-6 col-sm-4 col-md-6 col-lg-4 widget-pie__item">
          <div class="easy-pie-chart" data-percent="32" data-size="80" data-track-color="rgba(0,0,0,0.35)" data-bar-color="#fff">
            <span class="easy-pie-chart__value">32</span>
          </div>
          <div class="widget-pie__title">Server<br> Processing</div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Server Process</h4>
          <h6 class="card-subtitle">Maecenas faucibus mollis interdum porttitor</h6>

          <div class="flot-chart flot-dynamic"></div>
          <div class="flot-chart-legends flot-chart-legends--dynamic"></div>
        </div>
      </div>
    </div>

    <footer class="footer hidden-xs-down">
      <p>Â© Super Admin Responsive. All rights reserved.</p>

      <ul class="nav footer__nav">
        <a class="nav-link" href="">Homepage</a>

        <a class="nav-link" href="">Company</a>

        <a class="nav-link" href="">Support</a>

        <a class="nav-link" href="">News</a>

        <a class="nav-link" href="">Contacts</a>
      </ul>
    </footer>
  </section>
</main>


<audio id="panel-beep">
  <source src="audio/computerbeep_23.mp3"/>
</audio>

<audio id="panel-beep2">
  <source src="audio/computerbeep_35.mp3"/>
</audio>

<audio id="panel-beep3">
  <source src="audio/computerbeep_27.mp3"/>
</audio>

<!-- Javascript -->
<!-- Vendors -->
<script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
<script src="vendors/bower_components/popper.js/dist/umd/popper.min.js"></script>
<script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="vendors/bower_components/jquery.scrollbar/jquery.scrollbar.min.js"></script>
<script src="vendors/bower_components/jquery-scrollLock/jquery-scrollLock.min.js"></script>

<script src="vendors/bower_components/salvattore/dist/salvattore.min.js"></script>
<script src="vendors/bower_components/flot/jquery.flot.js"></script>
<script src="vendors/bower_components/flot/jquery.flot.resize.js"></script>
<script src="vendors/bower_components/flot.curvedlines/curvedLines.js"></script>
<script src="vendors/bower_components/jqvmap/dist/jquery.vmap.min.js"></script>
<script src="vendors/bower_components/jqvmap/dist/maps/jquery.vmap.world.js"></script>
<script src="vendors/bower_components/jquery.easy-pie-chart/dist/jquery.easypiechart.min.js"></script>
<script src="vendors/bower_components/peity/jquery.peity.min.js"></script>
<script src="vendors/bower_components/moment/min/moment.min.js"></script>

<!-- Charts and maps-->
<script src="demo/js/flot-charts/curved-line.js"></script>
<script src="demo/js/flot-charts/line.js"></script>
<script src="demo/js/flot-charts/dynamic.js"></script>
<script src="demo/js/flot-charts/chart-tooltips.js"></script>

<!-- App functions and actions -->
<script src="js/inc/functions/app.js"></script>


<script src="../js/sobel.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/nipplejs.min.js"></script>
<script src="../js/keypress.js"></script>

<script>

  var hostname = "/";
  if (location.hostname === "localhost" || location.hostname === "local.elosoft.tw" || location.hostname === "127.0.0.1") {
    $("#stream_container").attr("src", "http://192.168.1.125:8080/video_stream.jpg?time=1&pDelay=120000");
    hostname = "http://192.168.1.125:8080/";
  }
  else {
    $("#stream_container").attr("src", "/video_stream.jpg?time=1&pDelay=120000");
    hostname = "/";
  }

  var backgroundCheck;
  var LastStatusCheck = null;
  var BigPictureTimeout = null;
  var StatusTimeout = [];
  var LastBigPicture = "";

  var LastLeftSpeed = 0;
  var LastRightSpeed = 0;
  var SendMotorsOffSignal = 0;


  var front_left_revs_array = [];
  var front_right_revs_array = [];
  var rear_left_revs_array = [];
  var rear_right_revs_array = [];

  var life_counter_array = [];
  var floor_sensor_left_array = [];
  var floor_sensor_right_array = [];
  var distance_sensor_array = [];

  function checkTime(i) {
    if (i < 10) {
      i = "0" + i
    }
    return i;
  }

  var imageNr = 0; // Serial number of current image
  var finished = new Array(); // References to img objects which have finished downloading
  var paused = false;
  var img;
  var canvas;
  var context;

  var StatusType = 0;
  var StatusRow = 0;
  var CameraRunning = false;


  function grayscale(input, output) {
    //Get the context for the loaded image
    var inputContext = input.getContext("2d");
    //get the image data;
    var imageData = inputContext.getImageData(0, 0, input.width, input.height);
    //Get the CanvasPixelArray
    var data = imageData.data;

    //Get length of all pixels in image each pixel made up of 4 elements for each pixel, one for Red, Green, Blue and Alpha
    var arraylength = input.width * input.height * 4;
    //Go through each pixel from bottom right to top left and alter to its gray equiv

    //Common formula for converting to grayscale.
    //gray = 0.3*R + 0.59*G + 0.11*B
    for (var i = arraylength - 1; i > 0; i -= 4) {
      //R= i-3, G = i-2 and B = i-1
      //Get our gray shade using the formula
      var gray = 0.3 * data[i - 3] + 0.59 * data[i - 2] + 0.11 * data[i - 1];
      //Set our 3 RGB channels to the computed gray.
      data[i - 3] = gray;
      data[i - 2] = gray;
      data[i - 1] = gray;

    }

    //get the output context
    var outputContext = output.getContext("2d");

    //Display the output image
    outputContext.putImageData(imageData, 0, 0);
  }


  // Two layers are always present (except at the very beginning), to avoid flicker
  setInterval(function () {

    if (CameraRunning) {
      var img = document.getElementById('stream_container');

//  console.log(img.width+" "+img.height);

      if (img.height > 0) {

        canvas.width = img.width;
        canvas.height = img.height;

        context.drawImage(img, 0, 0, img.width, img.height);

        var imageData = context.getImageData(0, 0, img.width, img.height);
        var sobelData = Sobel(imageData);
        var sobelImageData = sobelData.toImageData();
        context.putImageData(sobelImageData, 0, 0);
      }
    }

//  grayscale(canvas, canvas);
  }, 1000);


  function imageOnclick() { // Clicking on the image will pause the stream
    paused = !paused;
  }


  function GetTime() {
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    return h + ":" + m + ":" + s;
  }


  function startCamera() {
    let UrlToGet = hostname + "start_camera";

    if (!CameraRunning) {
      CameraRunning = true;
      $.get(UrlToGet, function (data, status) {
        console.log("Data: " + data + "    -- Status: " + status);

        if (location.hostname === "localhost" || location.hostname === "local.elosoft.tw" || location.hostname === "127.0.0.1") {
          $("#stream_container").attr("src", "http://192.168.1.125:8080/video_stream.jpg?time=1&pDelay=120000");
        }
        else {
          $("#stream_container").attr("src", "/video_stream.jpg?time=1&pDelay=120000");
        }

        setTimeout(function () {
          CameraRunning = false;
        }, 10000);

      });
    }
  }

  function GetStatus() {

    if (StatusType == 0) {
      StatusType = 1;
    }
    else {
      StatusType = 0;
    }

    if (StatusType == 1) {
      var QData = "<Get_Data,0,0,msg>";
      var UrlToGet = hostname + "write_data?q=" + QData;
      $.get(UrlToGet, function (data, status) {
        //console.log("Data: " + data + "    -- Status: " + status);
      });
    }

    if (StatusType == 0) {
      var UrlToGet = hostname + "read_data";
      var data = {};

      $.ajax({
        url: UrlToGet,
        data: data,
        success: function (data, status) {
          if (status == "success" && data.length > 0) {
            //console.log("Status: " + status);
//        console.log(data);


            $.each(data, function (key, value) {
              key = key + 0;
              StatusRow++;
              if (StatusRow > 2) {
                StatusRow = 0;
              }

              try {
                var datajson = JSON.parse(value.data);
                if (datajson["us"] == "0") {
                  datajson["us"] = 200;
                }

                front_left_revs_array.push(datajson["fle"]);
                front_right_revs_array.push(datajson["fre"]);
                rear_left_revs_array.push(datajson["ble"]);
                rear_right_revs_array.push(datajson["bre"]);

                life_counter_array.push(datajson["c"]);
                floor_sensor_left_array.push(datajson["lh"]);
                floor_sensor_right_array.push(datajson["rh"]);
                distance_sensor_array.push(datajson["us"]);

                if (front_left_revs_array.length > 12) {
                  front_left_revs_array.shift();
                }
                if (front_right_revs_array.length > 12) {
                  front_right_revs_array.shift();
                }
                if (rear_left_revs_array.length > 12) {
                  rear_left_revs_array.shift();
                }
                if (rear_right_revs_array.length > 12) {
                  rear_right_revs_array.shift();
                }
                if (life_counter_array.length > 12) {
                  life_counter_array.shift();
                }
                if (floor_sensor_left_array.length > 12) {
                  floor_sensor_left_array.shift();
                }
                if (floor_sensor_right_array.length > 12) {
                  floor_sensor_right_array.shift();
                }
                if (distance_sensor_array.length > 12) {
                  distance_sensor_array.shift();
                }

                $("#front_left_revs_array").html(front_left_revs_array.join());
                $("#front_right_revs_array").html(front_right_revs_array.join());
                $("#rear_left_revs_array").html(rear_left_revs_array.join());
                $("#rear_right_revs_array").html(rear_right_revs_array.join());
                $("#life_counter_array").html(life_counter_array.join());
                $("#floor_sensor_left_array").html(floor_sensor_left_array.join());
                $("#floor_sensor_right_array").html(floor_sensor_right_array.join());
                $("#distance_sensor_array").html(distance_sensor_array.join());

                $("#front_left_revs").html(datajson["fle"]);
                $("#front_right_revs").html(datajson["fre"]);
                $("#rear_left_revs").html(datajson["ble"]);
                $("#rear_right_revs").html(datajson["bre"]);

                $("#life_counter").html(datajson["c"]);
                $("#floor_sensor_left").html(datajson["lh"]);
                $("#floor_sensor_right").html(datajson["rh"]);

                $("#distance_sensor").html(datajson["us"]);

                $('.peity-bar').each(function () {
                  var peityWidth = ($(this).attr('data-width')) ? $(this).attr('data-width') : 65;

                  $(this).peity('bar', {
                    height: 36,
                    fill: ['rgba(255,255,255,0.85)'],
                    width: peityWidth,
                    padding: 0.2
                  });
                });

              } catch (e) {
                console.log(e);
              }

            });


          }

          LastStatusCheck = data;
        },
        dataType: "json"
      });
    }


  }

  function detectmob() {
    if (navigator.userAgent.match(/Android/i)
      || navigator.userAgent.match(/webOS/i)
      || navigator.userAgent.match(/iPhone/i)
      || navigator.userAgent.match(/iPad/i)
      || navigator.userAgent.match(/iPod/i)
      || navigator.userAgent.match(/BlackBerry/i)
      || navigator.userAgent.match(/Windows Phone/i)
    ) {
      return true;
    }
    else {
      return false;
    }
  }

  function detectmob2() {
    if (window.innerWidth <= 800 && window.innerHeight <= 600) {
      return true;
    }
    else {
      return false;
    }
  }

  var s = function (sel) {
    return document.querySelector(sel);
  };

  $(document).ready(function () {
    canvas = document.getElementById("image_process_canvas");
    context = canvas.getContext("2d");

    var static = nipplejs.create({
      zone: s('#joystick_control_div'),
      size: 200,
      position: {
        left: '50%',
        top: '50%'
      },
      color: 'red'
    });


    static.on('hidden', function (evt, data) {
      var QData = "operation=motion&FL=off&FR=off&BL=off&BR=off";
      var UrlToGet = hostname + "controls?" + QData;

      $.get(UrlToGet, function (data, status) {
        console.log("Data: " + data + "    -- Status: " + status);
      });
    });


    static.on('start end', function (evt, data) {
//    console.log(evt);
//    console.log(data);

      if (evt.type === "end") {
        var QData = "operation=motion&FL=off&FR=off&BL=off&BR=off";
        var UrlToGet = hostname + "controls?" + QData;

        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);

          var UrlToGet = hostname + "write_data?q=<Set_Face,1,3,>";
          $.get(UrlToGet, function (data, status) {
            console.log("Data: " + data + "    -- Status: " + status);
          });

        });
      }
      else {
        var UrlToGet = hostname + "write_data?q=<Set_Face,1,6,>";
        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });
      }

    });

    function resolveToPoint(rad, diameter) {
      var r = diameter / 2;
      return {mX: r * Math.cos(rad), mY: r * Math.sin(rad)};
    }

    static.on('move', function (evt, data) {
//    console.log(evt);
//    console.log(data);

      //90 to 0 == forward to right
      //270 to 360 == reverse to right
      //180 to 270 == left to reverse
      //180 to 90 == left to forward

      if (typeof data.angle.radian !== "undefined") {
        var QData = "";
        var XYSpeed = resolveToPoint(data.angle.radian, data.distance * 2);
//      console.log(data.angle.radian);
//      console.log(resolveToPoint(data.angle.radian, 100));
//      console.log(data.distance);

        var RobotSpeed = 0;

        if (data.distance > 75 && data.distance <= 100) {
          RobotSpeed = 128;
        }
        if (data.distance > 50 && data.distance <= 75) {
          RobotSpeed = 96;
        }
        if (data.distance > 25 && data.distance <= 50) {
          RobotSpeed = 64;
        }
        if (data.distance > 5 && data.distance <= 25) {
          RobotSpeed = 32;
        }

        if (XYSpeed.mY > 5 || XYSpeed.mY < -5) {

          var Left_Direction = "fwd";
          var Right_Direction = "fwd";
          var Left_Speed = 0;
          var Right_Speed = 0;

          var XValue = XYSpeed.mX;
          if (XValue < 0) {
            XValue = XValue * (-1);
          }

          XValue = Math.round((50 - XValue) / 50);

          if (XYSpeed.mY < 5) {
            Left_Direction = "bkw";
            Right_Direction = "bkw";
            Left_Speed = RobotSpeed;
            Right_Speed = RobotSpeed;

            if (XYSpeed.mX > 5) Right_Speed = Math.round(Right_Speed * XValue);
            if (XYSpeed.mX < -5) Left_Speed = Math.round(Left_Speed * XValue);
          }

          if (XYSpeed.mY > 5) {
            Left_Direction = "fwd";
            Right_Direction = "fwd";
            Left_Speed = RobotSpeed;
            Right_Speed = RobotSpeed;

            if (XYSpeed.mX > 5) Right_Speed = Math.round(Right_Speed * XValue);
            if (XYSpeed.mX < -5) Left_Speed = Math.round(Left_Speed * XValue);
          }

          if (Right_Speed > 128) {
            Right_Speed = 128;
          }
          if (Left_Speed > 128) {
            Left_Speed = 128;
          }

          if (Left_Speed !== LastLeftSpeed || Right_Speed !== LastRightSpeed) {
            LastLeftSpeed = Left_Speed;
            LastRightSpeed = Right_Speed;

            var QData = "operation=motion&FL=on&FL_dir=" + Left_Direction + "&FL_speed=" + Left_Speed + "&FR=on&FR_dir=" + Right_Direction + "&FR_speed=" + Right_Speed + "&BL=on&BL_dir=" + Left_Direction + "&BL_speed=" + Left_Speed + "&BR=on&BR_dir=" + Right_Direction + "&BR_speed=" + Right_Speed + "";

            startCamera();
            var UrlToGet = hostname + "controls?" + QData;
            $.get(UrlToGet, function (data, status) {
              console.log("Data: " + data + "    -- Status: " + status);

              if (Left_Direction === "bkw" && Right_Direction === "bkw") {
                var UrlToGet = hostname + "write_data?q=<Set_Face,1,8,>";
                $.get(UrlToGet, function (data, status) {
                  console.log("Data: " + data + "    -- Status: " + status);
                });
              }
              else if (Left_Direction === "fwd" && Right_Direction === "fwd") {
                var UrlToGet = hostname + "write_data?q=<Set_Face,1,10,>";
                $.get(UrlToGet, function (data, status) {
                  console.log("Data: " + data + "    -- Status: " + status);
                });
              }
            });

          }
          SendMotorsOffSignal = 0;
        }
        else {
          SendMotorsOffSignal++;

          if (SendMotorsOffSignal < 2) {
            var QData = "operation=motion&FL=off&FR=off&BL=off&BR=off";
            var UrlToGet = hostname + "controls?" + QData;

            $.get(UrlToGet, function (data, status) {
              console.log("Data: " + data + "    -- Status: " + status);

              var UrlToGet = hostname + "write_data?q=<Set_Face,1,3,>";
              $.get(UrlToGet, function (data, status) {
                console.log("Data: " + data + "    -- Status: " + status);
              });

            });
          }

        }

      }
    });


    var listener = new window.keypress.Listener();

    listener.register_combo({
      keys: "w", on_keyup: function () {
        startCamera();
        var QData = "operation=motion&FL=on&FL_dir=fwd&FL_speed=96&FR=on&FR_dir=fwd&FR_speed=96&BL=on&BL_dir=fwd&BL_speed=96&BR=on&BR_dir=fwd&BR_speed=96";
        var UrlToGet = hostname + "controls?" + QData;
        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });
      }
    });

    listener.register_combo({
      keys: "s", on_keyup: function () {
        startCamera();
        var QData = "operation=motion&FL=on&FL_dir=bkw&FL_speed=96&FR=on&FR_dir=bkw&FR_speed=96&BL=on&BL_dir=bkw&BL_speed=96&BR=on&BR_dir=bkw&BR_speed=96";
        var UrlToGet = hostname + "controls?" + QData;
        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });
      }
    });

    listener.register_combo({
      keys: "a", on_keyup: function () {
        startCamera();
        var QData = "operation=motion&FL=on&FL_dir=bkw&FL_speed=156&FR=on&FR_dir=fwd&FR_speed=156&BL=on&BL_dir=bkw&BL_speed=156&BR=on&BR_dir=fwd&BR_speed=156";
        var UrlToGet = hostname + "controls?" + QData;

        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });
      }
    });

    listener.register_combo({
      keys: "d", on_keyup: function () {
        startCamera();
        var QData = "operation=motion&FL=on&FL_dir=fwd&FL_speed=156&FR=on&FR_dir=bkw&FR_speed=156&BL=on&BL_dir=fwd&BL_speed=156&BR=on&BR_dir=bkw&BR_speed=156";
        var UrlToGet = hostname + "controls?" + QData;

        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });
      }
    });

    listener.register_combo({
      keys: "x", on_keyup: function () {
        startCamera();
        var QData = "operation=motion&FL=off&FR=off&BL=off&BR=off";
        var UrlToGet = hostname + "controls?" + QData;

        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });
      }
    });

    setInterval(function () {
      $("#clockplace").html(GetTime());
      GetStatus();
    }, 500);


    $('.start_camera_btn').on('click', function (evt) {
      evt.preventDefault();

      startCamera();
      var xnum = Math.random();
      document.getElementById('panel-beep3').play();
      return false;
    });


    $('.generic_btn').on('click', function () {
      document.getElementById('panel-beep3').play();

      var UrlToGet = $(this).data("sendthis");
      $.get(UrlToGet, function (data, status) {
        console.log("Data: " + data + "    -- Status: " + status);
      });

      startCamera();

      setTimeout(function () {
        let QData = "operation=motion&FL=off&FR=off&BL=off&BR=off";
        let UrlToGet = hostname + "controls?" + QData;

        $.get(UrlToGet, function (data, status) {
          console.log("Data: " + data + "    -- Status: " + status);
        });

      }, 2000);
    });

    $('.scan_btn').on('click', function () {
      var xnum = Math.random();
      document.getElementById('panel-beep2').play();
      var UrlToGet = hostname + "write_data?q=" + $(this).val();

      $.get(UrlToGet, function (data, status) {
        console.log("Data: " + data + "    -- Status: " + status);
      });
    });

    $('.camera_btn').on('click', function () {
      var xnum = Math.random();
      document.getElementById('panel-beep').play();
      var UrlToGet = hostname + "write_data?q=" + $(this).val();

      $.get(UrlToGet, function (data, status) {
        console.log("Data: " + data + "    -- Status: " + status);
      });
    });


    /*---------------------------------------
        Peity
    ----------------------------------------*/

    // Bar
    if ($('.peity-bar')[0]) {
      $('.peity-bar').each(function () {
        var peityWidth = ($(this).attr('data-width')) ? $(this).attr('data-width') : 65;

        $(this).peity('bar', {
          height: 36,
          fill: ['rgba(255,255,255,0.85)'],
          width: peityWidth,
          padding: 0.2
        });
      });
    }

    // Line
    if ($('.peity-line')[0]) {
      $('.peity-line').each(function () {
        var peityWidth = ($(this).attr('data-width')) ? $(this).attr('data-width') : 65;

        $(this).peity('line', {
          height: 50,
          fill: 'rgba(255,255,255,0.8)',
          stroke: 'rgba(255,255,255,0)',
          width: peityWidth,
          padding: 0.2
        });
      });
    }

    // Pie
    if ($('.peity-pie')[0]) {
      $('.peity-pie').each(function () {
        $(this).peity('pie', {
          fill: ['#fff', 'rgba(255,255,255,0.6)', 'rgba(255,255,255,0.2)'],
          height: 50,
          width: 50
        });
      });
    }

    // Donut
    if ($('.peity-donut')[0]) {
      $('.peity-donut').each(function () {
        $(this).peity('donut', {
          fill: ['#fff', 'rgba(255,255,255,0.6)', 'rgba(255,255,255,0.2)'],
          height: 50,
          width: 50
        });
      });
    }


    /*---------------------------------------
        Easy Pie Charts
    ----------------------------------------*/
    if ($('.easy-pie-chart')[0]) {
      $('.easy-pie-chart').each(function () {
        var value = $(this).data('value');
        var size = $(this).data('size');
        var trackColor = $(this).data('track-color');
        var barColor = $(this).data('bar-color');

        $(this).find('.easy-pie-chart__value').css({
          lineHeight: (size - 2) + 'px',
          fontSize: (size / 5) + 'px',
          color: barColor
        });

        $(this).easyPieChart({
          easing: 'easeOutBounce',
          barColor: barColor,
          trackColor: trackColor,
          scaleColor: 'rgba(255,255,255,0.15)',
          lineCap: 'round',
          lineWidth: 1,
          size: size,
          animate: 3000,
          onStep: function (from, to, percent) {
            $(this.el).find('.percent').text(Math.round(percent));
          }
        })
      });
    }

  });


</script>
</body>
</html>